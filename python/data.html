<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Python-cod</title>
    <link rel="stylesheet" href="/bootstrap.min.css" />
    <link rel="stylesheet" href="/main.css" />
</head>
<body>
  <div class ="header">
    <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/index.html">Главная</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/data.html">Подключение данных</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/table.html">Обработка таблиц</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/photo.html">Визуализация</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>

  <div class="container">
    <p class="text-start fs-2 fw-bold">Часть 1.1 Подготовка обучающей  и тестовой выборок</p>
    
    <p class="text-start fw-bolder py-1">Импорт библиотек</p>
      <p>import pandas as pd</p>
      <p>import matplotlib.pyplot as plt</p>
      <p>import numpy as np</p>
      <p>import time</p>
      <p>from colorama import Fore, Back, Style</p>
      <p>from sklearn import datasets, linear_model</p>
      
      <p class="text-start fw-bolder py-1">Создаем необходимые списки</p>
      
      <p>from sklearn.linear_model import LinearRegression</p>
      <p>timelists = list()</p>
      <p>newmatrix1lists = list()</p>
      <p>newmatrix2lists = list()</p>
      <p>sestimelist = list()</p>
    
      <p class="text-start fw-bolder py-1">Загрузка баз данных</p>
      
      <p>rd_test = pd.read_csv("test_ses.csv", delimiter=",")</p>
      <p>df_test = pd.DataFrame(rd_test)</p>
      <p>rd_train = pd.read_csv("train_ses.csv", delimiter=",")</p>
      <p>df_train = pd.DataFrame(rd_train)</p>
      
      <p>def dropnulls():</p>
        <p class="text-start fw-bolder px-4 py-1">Удаление пустых значений</p>
        <p class="px-4">df_test.fillna(0)</p>
        <p class="px-4">df_train.fillna(0)</p>
        <p class="px-4">print("Произвел удаление пустых значений.")</p>

      <p>def sortdb():</p>
        <p class="px-4 fw-bolder spy-1">Сортировка по файлу</p>
        <p class="px-4">df_test.describe()</p>  
        <p class="px-4">df_train.describe()</p>  
        <p class="px-4">print("Произвел сортировку по файлу.")</p>  
        
      <p>def sortsess():</p> 
        <p class="px-4 fw-bolder">Сортируем Таблицы по номеру ссесий</p>
        <p class="px-4">df_test.sort_values('session_id')</p>
        <p class="px-4">df_train.sort_values('session_id')</p>
        <p class="px-4">print("Произвел сортировку таблиц по номеру сессий.")</p>
          
   <p class="text-start fs-2 fw-bold py-3">Часть 1.2 Работа с разреженным форматом данных</p>      
      <p class="text-start fw-bolder py-1">Создадим метод с матрицей для отражения "мешка сайтов", для базы test_ses</p>     
        <p>def visitsits_dftest():</p>   
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">sits_index = df_test['site1'][inds]</p>
            <p class="px-5">sites_session = df_test['session_id'][inds]</p>
            <p class="px-5">new_matix = np.matrix(sits_index, sites_session)</p>
            <p class="px-5">newmatrix1lists.append(new_matix)</p>
          <p class="px-4">return newmatrix1lists</p>
           
      <p class="text-start fw-bolder py-1">Создадим метод с матрицей для отражения "мешка сайтов", для базы train_ses</p>        
        <p>def visitsits_dftrain():</p>   
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">df_train['session_id'][inds]</p>
            <p class="px-5">sits_index = df_test['site1'][inds]</p>
            <p class="px-5">sites_session = df_test['session_id'][inds]</p>
            <p class="px-5">new_matix = np.matrix(sits_index, sites_session)</p>
            <p class="px-5">newmatrix2lists.append(new_matix)</p>
          <p class="px-4">return newmatrix2lists</p>
                    
            
      <p class="text-start fw-bolder py-1">Создадим метод с матрицей для отражения "мешка сайтов", раномные значения</p>        
        <p>def visitsits_dftrain_rand():</p>   
          <p class="px-4">for inde in range(10):</p>
              <p class="px-5">df_ands = pd.DataFrame(np.matrix(np.random.rand(1, 1)), columns=[df_train['site1'][inde]], index=[df_train['session_id'][inde]])</p>
              <p class="px-5">print(df_ands)</p>

      <p class="text-start fw-bolder py-1">Данный метод отражает Сайт, Сесию, и имеется ли дублкат сессий на данном сайте. (Session: Сессия Sits1Index: Индекс сайта Duplicate: True/False)</p> 
        <p>def sutes_session_dub():</p>   
          <p class="px-4">sites_session = 'session_id'</p>
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">ses = df_train['session_id'][inds]</p> 
            <p class="px-5">sits1_index = df_test['site1'][inds]</p>
            <p class="px-5">sits2_index = df_test['site2'][inds]</p>
            <p class="px-5">sits3_index = df_test['site3'][inds]</p>
            <p class="px-5">sits4_index = df_test['site4'][inds]</p>
            <p class="px-5">sits5_index = df_test['site5'][inds]</p>
            <p class="px-5">sits6_index = df_test['site6'][inds]</p>
            <p class="px-5">sits7_index = df_test['site7'][inds]</p>
            <p class="px-5">sits8_index = df_test['site8'][inds]</p>
            <p class="px-5">sits9_index = df_test['site9'][inds]</p>
            <p class="px-5">sits10_index = df_test['site10'][inds]</p>
            <p class="px-5">sitedub1 = df_test.duplicated(subset=[sites_session, 'site1']).any()</p>
            <p class="px-5">sitedub2 = df_test.duplicated(subset=[sites_session, 'site2']).any()</p>
            <p class="px-5">sitedub3 = df_test.duplicated(subset=[sites_session, 'site3']).any()</p>
            <p class="px-5">sitedub4 = df_test.duplicated(subset=[sites_session, 'site4']).any()</p>
            <p class="px-5">sitedub5 = df_test.duplicated(subset=[sites_session, 'site5']).any()</p>
            <p class="px-5">sitedub6 = df_test.duplicated(subset=[sites_session, 'site6']).any()</p>
            <p class="px-5">sitedub7 = df_test.duplicated(subset=[sites_session, 'site7']).any()</p>
            <p class="px-5">sitedub8 = df_test.duplicated(subset=[sites_session, 'site8']).any()</p>
            <p class="px-5">sitedub9 = df_test.duplicated(subset=[sites_session, 'site9']).any()</p>
            <p class="px-5">sitedub10 = df_test.duplicated(subset=[sites_session, 'site10']).any()</p>
            <p class="px-5">print(Fore.YELLOW + "Session: {}".format(ses)</p>
            <p class="px-5">+" \nSits1Index: {}".format(sits1_index)+ " Duplicate: {}".format(sitedub1)</p>
              
                   
            <p class="px-5"> +" \nSits2Index: {}".format(sits2_index)+ " Duplicate: {}".format(sitedub2)</p>
            <p class="px-5"> +" \nSits3Index: {}".format(sits3_index)+ " Duplicate: {}".format(sitedub3)</p>
            <p class="px-5">+" \nSits4Index: {}".format(sits4_index)+ " Duplicate: {}".format(sitedub4)</p>
            <p class="px-5">+" \nSits5Index: {}".format(sits5_index)+ " Duplicate: {}".format(sitedub5)</p>
            <p class="px-5">+" \nSits6Index: {}".format(sits6_index)+ " Duplicate: {}".format(sitedub6)</p>
            <p class="px-5">+" \nSits7Index: {}".format(sits7_index)+ " Duplicate: {}".format(sitedub7)</p>
            <p class="px-5">+" \nSits8Index: {}".format(sits8_index)+ " Duplicate: {}".format(sitedub8)</p>
            <p class="px-5">+" \nSits9Index: {}".format(sits9_index)+ " Duplicate: {}".format(sitedub9)</p>
            <p class="px-5">+" \nSits10Index: {}".format(sits10_index)+ " Duplicate: {}".format(sitedub10)</p>
            <p class="px-5">)</p>
      
    <p class="text-start fs-2 fw-bold py-3">1.3 Визуальный анализ данных</p>
      <p class="text-start fw-bolder py-1">Отрисуем график посещений сайтов, чтобы понять куда чаще заходил пользователь. (База : test_ses.csv)</p> 
      <p>def sist_check_df_test():</p>  
        <p class="px-4">plt.plot(df_test['site1'], color="b")</p>
        <p class="px-4">plt.plot(df_test['site2'], color="g")</p>
        <p class="px-4">plt.plot(df_test['site3'], color="r")</p>
        <p class="px-4">plt.plot(df_test['site4'], color="c")</p>
        <p class="px-4">plt.plot(df_test['site5'], color="m")</p>
        <p class="px-4">plt.plot(df_test['site6'], color="y")</p>
        <p class="px-4">plt.plot(df_test['site7'], color="silver")</p>
        <p class="px-4">plt.plot(df_test['site8'], color="wheat")</p>
        <p class="px-4">plt.plot(df_test['site9'], color="lime")</p>
        <p class="px-4">plt.plot(df_test['site10'], color="violet")</p>
        <p class="px-4">plt.show()</p>

      <p class="text-start fw-bolder py-1">Отрисуем график посещений сайтов, чтобы понять куда чаще заходил пользователь. (База : train_ses.csv)</p> 
        <p>def sist_check_df_train():</p>
        <p class="px-4">plt.plot(df_train['site1'], color="b")</p>
        <p class="px-4">plt.plot(df_train['site2'], color="g")</p>
        <p class="px-4">plt.plot(df_train['site3'], color="r")</p>
        <p class="px-4">plt.plot(df_train['site4'], color="c")</p>
        <p class="px-4">plt.plot(df_train['site5'], color="m")</p>
        <p class="px-4">plt.plot(df_train['site6'], color="y")</p>
        <p class="px-4">plt.plot(df_train['site7'], color="silver")</p>
        <p class="px-4">plt.plot(df_train['site8'], color="wheat")</p>
        <p class="px-4">plt.plot(df_train['site9'], color="lime")</p>
        <p class="px-4">plt.plot(df_train['site10'], color="violet")</p>
        <p class="px-4">plt.show()</p>
        
    <p class="text-start fs-2 fw-bold py-3">1.4 Конструирование признаков (Feature Engineering)</p>
      <p class="fw-bolder py-1">Создаем метод new_time, для более удобной и компактного преобразования времени во float.</p>
      <p>def new_time(database,table_name):</p>
      <p class="fw-bolder px-2 py-1">Преобразуем время в значение float</p>
        <p class="px-2">dfsizer = 0</p>
        <p class="px-2">try:</p>
          <p class="px-3">while (dfsizer = database.size):</p>
            <p class="px-5">t = time.strptime(database[table_name][dfsizer], '%Y-%m-%d %H:%M:%S')</p>
            <p class="px-5">new_time = time.strftime('%Y%m%d %H%M%S', t)</p>
            <p class="px-5">database[table_name] = database[table_name].replace(database[table_name][dfsizer], new_time)</p>
            <p class="px-5">timelists.append(new_time)</p>
            <p class="px-5">dfsizer += 1</p>
          

        <p class="px-2">except Exception as ex:</p>
          <p class="px-3">pass</p>
        <p class="px-2">return ''.join(timelists)</p> 
  
        <p>def ses_time(database,table_name):</p>               
          <p class="px-2">try:</p>   
            <p class="px-3">for inds in range(database.size):</p>     
            <p class="px-4">sestimelist.append(</p>
            <p class="px-5">str(database['session_id'][inds]) + "-" + str(database[table_name][inds]))</p>
      
          <p class="px-2">except Exception as ex:</p>
            <p class="px-3">pass</p> 
          <p class="px-2">return ''.join(sestimelist):</p>  
              
        <p>def target():</p>  
          <p class="px-2">for inds in range(df_train.size):</p>
            <p class="px-3">if(df_train['target'][inds] == 1):</p>
              <p class="px-4">print("Сесия: {}".format(df_train['session_id']) + " Сайты: {}".format(df_train['site1'])+" / {}".format(df_train['site2'])+" / {}".format(df_train['site3'])+" / {}".format(df_train['site4'])+" / {}".format(df_train['site5'])+" / {}".format(df_train['site6'])+" / {}".format(df_train['site7'])+" / {}".format(df_train['site8'])+" / {}".format(df_train['site9'])+" / {}".format(df_train['site10']))</p>       
                      
        <p>def linrg():</p>
          <p class="px-2">Загружаем данные только с двумя признаками</p>
          <p class="px-2">length = 10</p>
          <p class="px-2">x = np.arange(length, dtype=float).reshape((length, 1))</p>
          <p class="px-2">y = x + (np.random.rand(length) * 10).reshape((length, 1))</p>
          <p class="px-2">.</p>
          <p class="px-2">x = x.reshape(length, 1)</p>
          <p class="px-2">y = y.reshape(length, 1)</p>
          <p class="px-2">regr = linear_model.LinearRegression()</p>
          <p class="px-2">y = y.reshape(length, 1)</p>
          <p class="px-2">regr.fit(x, y)</p>
          <p class="px-2">.</p>
          <p class="px-2">plt.scatter(x, y, color='black')</p>
          <p class="px-2">plt.plot(x, regr.predict(x), color='blue', linewidth=3)</p>
          <p class="px-2">plt.xticks(())</p>
          <p class="px-2">plt.yticks(())</p>
          <p class="px-2">plt.show()</p>
    </div>
  
</body>
</html>